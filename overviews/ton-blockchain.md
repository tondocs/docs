[https://github.com/ton-blockchain/docs/blob/master/docs/overviews/TON_blockchain_overview.md]

Акторские цепочки

Один актор

Термины "смарт-контракт", "аккаунт" и "актор" используются в данном документе взаимозаменяемо для определения сущности блокчейна.

Рассмотрим один смарт-контракт. В TON это вещь, обладающая такими свойствами, как address (адрес), code (код), data (данные), balance (баланс) и другие. Другими словами, это объект, который имеет определенное хранилище и поведение. Это поведение имеет следующую модель:


что-то происходит (наиболее распространенная ситуация - контракт получает сообщение)
контракт обрабатывает это событие в соответствии со своими свойствами, выполняя свой код в виртуальной машине TON
контракт изменяет свои собственные свойства (код, данные и другие)
контракт опционально генерирует исходящие сообщения
контракт переходит в режим ожидания до следующего события


Комбинация этих шагов называется транзакцией. Важно, чтобы события обрабатывались одно за другим, поэтому транзакции строго упорядочены и не могут прерывать друг друга.

Эта модель поведения хорошо известна и называется Актор.

Последовательность транзакций Tx1 -> Tx2 -> Tx3 -> .... можно назвать цепочкой. И в рассматриваемом случае она называется AccountChain, чтобы подчеркнуть, что это цепочка транзакций одного счета.

Теперь, поскольку узлы, обрабатывающие транзакции, должны время от времени согласовывать состояние смарт-контракта (достигать консенсуса относительно состояния), эти транзакции объединяются в пакет. [Tx1 -> Tx2] -> [Tx3 -> Tx4 -> Tx5] -> [] -> [Tx6] пакетирование не вмешивается в последовательность, каждая транзакция по-прежнему имеет только один prev tx и максимум один next tx, но теперь эта последовательность разрезана на блоки.

Также целесообразно включить в блоки очереди входящих и исходящих сообщений. В этом случае блок будет содержать полный набор информации, определяющей и описывающей, что произошло с смарт-контрактом в течение этого блока. 

Шарды

Теперь рассмотрим множество аккаунтов. Мы можем получить несколько AccountChains и хранить их вместе, такой набор AccountChains называется ShardChain. Таким же образом мы можем разрезать ShardChain на ShardBlocks, которые являются совокупностью отдельных AccountBlocks.

Обратите внимание, что поскольку ShardChain состоит из легко различимых AccountChain, мы можем легко разделить их. Таким образом, если у нас есть 1 ShardChain, которая описывает события, происходящие с 1 миллионом счетов, и в ней слишком много транзакций в секунду для обработки и хранения одним узлом, мы просто разделим эту цепочку на две меньшие, каждая из которых будет учитывать полмиллиона счетов, и каждая цепочка будет обрабатываться на отдельном узле.

Аналогично, если некоторые шарды стали слишком незанятыми, они могут быть объединены в один больший шард.

Очевидно, что существует два предельных случая: когда шард содержит только одну учетную запись (и поэтому не может быть разделен дальше) и когда шард содержит все учетные записи.

Учетные записи могут взаимодействовать друг с другом, посылая сообщения. Существует специальный механизм маршрутизации, который перемещает сообщения из исходящих очередей в соответствующие входящие очереди и гарантирует, что 1) все сообщения будут доставлены 2) сообщения будут доставлены последовательно (сообщение, отправленное раньше, достигнет места назначения раньше).

Примечание: чтобы сделать разделение и слияние детерминированным, объединение цепочек аккаунтов в шарды основано на битовом представлении адресов аккаунтов. Таким образом, все аккаунты в шардчейне будут иметь одинаковый двоичный префикс (например, все адреса будут начинаться с 0b00101).

Блокчейн

Агрегация всех шардов, которые содержат все счета, ведущие себя по одному набору правил, называется блокчейн.

В TON может быть много наборов правил и, соответственно, много блокчейнов, которые работают одновременно и могут взаимодействовать друг с другом, посылая сообщения по межцепочечному каналу так же, как счета одной цепи взаимодействуют друг с другом.

Мастерчейн

Существует необходимость в синхронизации маршрутизации сообщений и выполнения транзакций. Другими словами, узлам сети нужен способ зафиксировать некоторую "точку" в состоянии мультицепей и достичь консенсуса относительно этого состояния. В TON для этой цели используется специальная цепочка MasterChain. Блоки мастерчейна содержат дополнительную информацию (хэши последних блоков) обо всех остальных цепочках в системе, поэтому любой наблюдатель однозначно определяет состояние всех многоцепочечных систем в каком-то блоке мастерчейна.